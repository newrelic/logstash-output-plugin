deploy_mechanism: none
display_name: "NewRelicLogstashOutput"
require_sidekick_approval: false
test_suites:
- command: |
    mkdir -p ~/.gem
    curl -u $ARTIFACTORY_USERNAME:$ARTIFACTORY_PASSWORD https://artifacts.datanerd.us/api/gems/newrelic-gems-local/api/v1/api_key.yaml -o ~/.gem/credentials
    chmod 0600 ~/.gem/credentials
    bundle install
  environment:
    dockerfile: Dockerfile
  name: Unit Tests
build:
  environment:
    dockerfile: Dockerfile
    secret_env_vars:
    - name: ARTIFACTORY_USERNAME
      shared_path: artifactory
    - name: ARTIFACTORY_PASSWORD
      shared_path: artifactory
  master_merge_version_bump:
    command: |
      bundle install
      gem bump --version pre --no-commit
  publish:
    command: |
      mkdir -p ~/.gem
      curl -u $ARTIFACTORY_USERNAME:$ARTIFACTORY_PASSWORD https://artifacts.datanerd.us/api/gems/newrelic-gems-local/api/v1/api_key.yaml -o ~/.gem/credentials
      chmod 0600 ~/.gem/credentials
      bundle install
      gem release --host https://artifacts.datanerd.us/api/gems/newrelic-gems-local
  read_version:
    command: cat ./lib/logstash/version.rb | grep VERSION | awk '{
      gsub("\"", "", $3); print $3 }'

